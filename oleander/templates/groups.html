{% extends '_layout.html' %}
{% from '_macros.html' import form_errors, contact_box %}


{% block content %}
<h2>Groups</h2>

{% if action == 'new' %}
    <div class="group">
        <form action="{{ url_for('groups', action='new') }}" method="post">
            {{ form_errors(form) }}

            <h3>{{ form.name(placeholder=form.name.label.text) }}</h3>
            <p><a href="{{ url_for('groups') }}">Cancel</a> or <button type="submit">Save</button></p>

            <h4>Members</h4>
            {{ form.contact_ids_str() }}
            <ul></ul>
            <p><label for="add_member">Add member</label> <input id="add_member" type="search"></p>
            <ul></ul>

            {{ form.csrf_token }}
        </form>
    </div>
{% else %}
    <div class="group">
        <p><a href="{{ url_for('groups', action='new') }}">Create new</a></p>
    </div>
{% endif %}

{% for group in groups %}
<div class="group">
    {% if edited_group == group %}
        <form action="{{ url_for('groups', action='edit', id=group.id) }}" method="post">
            {{ form_errors(form) }}

            <h3>{{ form.name(placeholder=form.name.label.text) }}</h3>
            <p><a href="{{ url_for('groups') }}">Cancel</a> or <button type="submit">Save</button></p>

            <h4>Members</h4>
            {{ form.contact_ids_str() }}
            <ul></ul>
            <p><label for="add_member">Add member</label> <input id="add_member" type="search"></p>
            <ul></ul>

            {{ form.csrf_token }}
        </form>
    {% else %}
        <h3><a href="#">{{ group.name }}</a></h3>
        <p><a href="{{ url_for('groups', action='edit', id=group.id) }}">Edit</a></p>

        {% with contacts = group.contacts|list %}
            {% if contacts %}
                <h4>Members</h4>
                <ul>
                    {% for contact in contacts %}
                        <li>{{ contact_box(contact) }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>Empty group.</p>
            {% endif %}
        {% endwith %}
    {% endif %}
</div>
{% endfor %}

<style>
    .group { background: #EEE; padding: 0.001em 1em; margin: 1em 0; }
</style>
{% endblock %}